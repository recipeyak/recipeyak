# Recipe Yak

> Application to automate the selection of meals and creation of shopping lists.

## Why?

To have a centralized location where multiple people can organize a meal plan.

## Prior Art / Alternatives

| name                                                                                                          | created                                                                                                                                                                    | open source?                                  |
| ------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------- |
| [Meal Master](https://web.archive.org/web/20090327150531/http://episoft.home.comcast.net/~episoft/mmdesc.htm) | [1986](https://outpostbbs.net/mealmaster.html)                                                                                                                             | ❌                                            |
| [Recipe Box](https://www.recipebox.com)                                                                       | [1991-11-01](https://web.archive.org/web/20110202122014/http://recipebox.com/)                                                                                             | ❌                                            |
| [MasterCook](https://mastercook.com)                                                                          | [1992](https://support.mastercook.com/hc/en-us/articles/115001859663-MasterCook-Content-History)                                                                           | ❌                                            |
| [Home Cookin](https://web.archive.org/web/20120125063353/http://www.homecookinrecipesoftware.com:80/)         | [1992](https://web.archive.org/web/20120125063353/http://www.homecookinrecipesoftware.com:80/)                                                                             | ❌                                            |
| [Cookpad](https://cookpad.com/)                                                                               | [1998-03-01](https://en.wikipedia.org/wiki/Cookpad)                                                                                                                        | ❌                                            |
| [Cook'n](http://www.dvo.com)                                                                                  | [1999-05-27](https://web.archive.org/web/20000304113044/http://www.dvo.com/)                                                                                               | ❌                                            |
| [LargoRecipes](https://sourceforge.net/projects/largorecipes/)                                                | [2001-04](https://web.archive.org/web/20071023070658/http://www.recipewebservice.com/largorecipes/umldocs/parserclassdocs/src-html/IngredientAmountParser.html)            | ✅                                            |
| [Krecipes](http://krecipes.sourceforge.net)                                                                   | [2003-05-01](https://sourceforge.net/projects/krecipes/)                                                                                                                   | ✅                                            |
| [Big Oven](https://www.bigoven.com)                                                                           | [2004-02-04](https://web.archive.org/web/20040204023915/http://www.bigoven.com:80/index.htm)                                                                               | ❌                                            |
| [Mac Gourmet](https://web.archive.org/web/20080705134330/http://www.macgourmet.com/)                          | [2004-06-05](https://web.archive.org/web/20080705020658/http://www.macgourmet.com/release_notes/2004_06_01_macgourmet-release.html)                                        | ❌                                            |
| [Gourmet](http://thinkle.github.io/gourmet/)                                                                  | [2004-06-14](https://github.com/thinkle/gourmet/commit/76974abe13839ef3077456238fd163325cbb09da#diff-aac07aefec754086f5c344e2c233862f6a611c739b5647fd456c1b77d3577c79R247) | ✅                                            |
| [REML](https://sourceforge.net/projects/reml/)                                                                | [2005-03-02](https://sourceforge.net/projects/reml/files/reml%20Source/reml-ref%20Source%200.2/)                                                                           | ❌                                            |
| [Connoisseur](https://web.archive.org/web/20080811205757/http://www.connoisseurx.com:80/)                     | [2008-08-06](https://web.archive.org/web/20080811205757/http://www.connoisseurx.com:80/)                                                                                   | ❌                                            |
| [Plan to Eat](https://www.plantoeat.com/welcome/)                                                             | [2008-09-06](https://web.archive.org/web/20080906204627/http://www.plantoeat.com:80/)                                                                                      | ❌                                            |
| [Yum Mac](https://web.archive.org/web/20081113150814/http://yum-mac.com:80/)                                  | [2008](https://web.archive.org/web/20081113150814/http://yum-mac.com:80/)                                                                                                  | ❌                                            |
| [Chicken Ping](http://web.archive.org/web/20090701031430/http://www.chickenping.com:80/)                      | [2009-06-22](http://web.archive.org/web/20090701031430/http://www.chickenping.com:80/)                                                                                     | ❌                                            |
| [Eat Your Books](https://www.eatyourbooks.com/)                                                               | [2009-08-01](https://www.eatyourbooks.com/blog/2009/08/01/welcome-to-eat-your-books)                                                                                       | ❌                                            |
| [MealBoard](https://www.mealboard.com)                                                                        | [2009-09-24](https://web.archive.org/web/20091014175504/http://www.mealboard.com/)                                                                                         | ❌                                            |
| [Punchfork](https://www.punchfork.com)                                                                        | [2010-05-19](https://web.archive.org/web/20110710234720/http://blog.punchfork.com/2010/05/)                                                                                | ❌                                            |
| [Open Eats](https://github.com/qgriffith-zz/OpenEats)                                                         | [2010-05-25](https://github.com/qgriffith-zz/OpenEats/commit/a823c31bd3d0e229a647a66c8cb19f5bf2a33462)                                                                     | ✅                                            |
| [Pepperplate](https://www.pepperplate.com)                                                                    | [2010-06-08](https://www.whois.com/whois/pepperplate.com)                                                                                                                  | ❌                                            |
| [Paprika](https://www.paprikaapp.com)                                                                         | [2010-08-16](https://www.whois.com/whois/paprikaapp.com)                                                                                                                   | ❌                                            |
| [Foodie](https://web.archive.org/web/20120220143348/http://foodiesharing.com/)                                | [2011](https://web.archive.org/web/20111129053047/http://foodiesharing.com:80/)                                                                                            | ❌                                            |
| [Copy Me That](https://www.copymethat.com)                                                                    | [2011-03-19](https://www.whois.com/whois/copymethat.com)                                                                                                                   | ❌                                            |
| [Anylist](https://www.anylist.com)                                                                            | [2012-04-04](https://twitter.com/AnyListApp)                                                                                                                               | ❌                                            |
| [Whisk](https://whisk.com)                                                                                    | [2013](https://whisk.com/about/)                                                                                                                                           | ❌                                            |
| [Mealime](https://apps.apple.com/gb/app/mealime-meal-plans-recipes/id1079999103)                              | [2013-01-20](https://www.indiehackers.com/product/mealime)                                                                                                                 | ❌                                            |
| [My Recipe Box](https://play.google.com/store/apps/details?id=fr.recettetek&pli=1)                            | [2013-04-20](https://play.google.com/store/apps/details?id=fr.recettetek&pli=1)                                                                                            | ❌                                            |
| [SideChef](https://play.google.com/store/apps/details?id=com.sidechef.sidechef)                               | [2014-10-11](https://play.google.com/store/apps/details?id=com.sidechef.sidechef)                                                                                          | ❌                                            |
| [Recipe Keeper](https://recipekeeperonline.com)                                                               | [2015-06-24](https://www.whois.com/whois/recipekeeperonline.com)                                                                                                           | ❌                                            |
| [Forks Meal Planner](https://www.forksmealplanner.com)                                                        | [2016-01-05](https://www.whois.com/whois/forksmealplanner.com)                                                                                                             | ❌                                            |
| [CookBook](https://thecookbookapp.com)                                                                        | [2016-08-28](https://www.instagram.com/p/BJpLw-2Aouh/)                                                                                                                     | ❌                                            |
| [Cinc](https://cinc.kitchen)                                                                                  | [2016-03-31](https://www.whois.com/whois/cinc.kitchen)                                                                                                                     | ❌                                            |
| [Grocy](https://grocy.info)                                                                                   | [2017-04-15](https://github.com/grocy/grocy/commit/d414c8702ef5fb4037a7f147a2fdda7e47989125)                                                                               | ✅                                            |
| [Grocery](https://www.smartgrocery.app)                                                                       | [2017-05-09](http://conradstoll.com/blog/2017/5/9/introducing-grocery-an-opinionated-shopping-list-app-for-iphone-and-apple-watch)                                         | ❌                                            |
| [Cooklist](https://www.cooklist.co/)                                                                          | [2017-05-26](https://www.whois.com/whois/cooklist.co)                                                                                                                      | ❌                                            |
| [Prepear](https://www.prepear.com)                                                                            | [2017-11-09](https://web.archive.org/web/20171204225008/https://prepear.com/)                                                                                              | ❌                                            |
| [Saffron](https://www.mysaffronapp.com)                                                                       | [2017-12-04](https://www.whois.com/whois/mysaffronapp.com)                                                                                                                 | ❌                                            |
| [Tandoor](https://github.com/TandoorRecipes/recipes)                                                          | [2018-01-31](https://github.com/TandoorRecipes/recipes/commit/598e0b1c698d14ca5ed75674b6ce92edaba3d6e4)                                                                    | ✅                                            |
| [Recipe Sage](https://github.com/julianpoy/RecipeSage)                                                        | [2018-02-18](https://github.com/julianpoy/RecipeSage/commit/b89e3575f839a20b849f40b5ca0208619524bb57)                                                                      | ✅                                            |
| [KookBook](https://github.com/KDE/kookbook)                                                                   | [2018-04-24](https://github.com/KDE/kookbook/commit/94f6b8bb07e248b6bb01d694c7ea673c161006bf)                                                                              | ✅                                            |
| [Recursive Recipes](https://github.com/schollz/recursive-recipes)                                             | [2018-05-07](https://github.com/schollz/recursive-recipes/commit/79eb5b65d35f209b861affd79524d8179b08cea3)                                                                 | ✅                                            |
| [NextCloud Cookbook](https://github.com/nextcloud/cookbook)                                                   | [2019-03-10](https://github.com/nextcloud/cookbook/commit/a14d2d5614cdb2960b2f90f0ac69eca2a16fd469)                                                                        | ✅                                            |
| [RecipeRadar](https://www.reciperadar.com)                                                                    | [2019-05-18](https://github.com/openculinary/backend/commit/b958a9f6659ecc9f09e6dde9214a2bab06589862)                                                                      | ✅                                            |
| [Crouton](https://crouton.app)                                                                                | [2019-10-14](https://twitter.com/_CroutonApp)                                                                                                                              | ❌                                            |
| [AnyMeal](https://github.com/wedesoft/anymeal)                                                                | [2020-05-07](https://github.com/wedesoft/anymeal/commit/74ac6865b7b9364f0e68e15c96962221b8f2dc0d)                                                                          | ✅                                            |
| [EnRecipes](https://enrecipes.vishnuraghav.com)                                                               | [2020-12-02](https://apt.izzysoft.de/fdroid/index/apk/com.vishnuraghav.EnRecipes)                                                                                          | ❌                                            |
| [Mealie](https://github.com/hay-kot/mealie/)                                                                  | [2020-12-24](https://github.com/hay-kot/mealie/commit/beed8576c2d0499f8db443d39a8e89a37590a126)                                                                            | ✅                                            |
| [Coopes](https://coopes.de)                                                                                   | [2021-03-11](https://apps.apple.com/de/app/coopes-der-essensplan/id1555086478)                                                                                             | ❌                                            |
| [Mela](https://mela.recipes)                                                                                  | [2021-03-15](https://www.whois.com/whois/mela.recipes)                                                                                                                     | ❌                                            |
| [Recipe Sage](https://recipesage.com)                                                                         | [2018-03-30](https://docs.recipesage.com/docs/release-notes/)                                                                                                              | [✅](https://github.com/julianpoy/recipesage) |
| [Reciped](https://www.reciped.io)                                                                             | [2021-05-19](https://www.whois.com/whois/reciped.io)                                                                                                                       | ❌                                            |
| [Famnom](https://www.famnom.com)                                                                              | [2021-08-27](http://famnom.com)                                                                                                                                            | [✅](https://github.com/umangsh/famnom)       |
| [CooklangApp](https://cooklang.org/app/)                                                                      | [2021-11-18](https://github.com/cooklang/cooklang-app-ios/commit/acf6de6fc8a2fcb77d5cbbffd5f1c5f9c31773d9)                                                                 | ❌                                            |
| [Homechart](https://homechart.app)                                                                            | [2021-11-22](https://github.com/candiddev/homechart/commit/644c28870c8a0e7f86adc95438332cbec891de3e)                                                                       | ❌                                            |
| [Meal DJ](https://mealdj.com)                                                                                 | [2021-12-29](https://apps.apple.com/us/app/appname/id1580876268)                                                                                                           | ❌                                            |
| [Mob](https://www.mob.co.uk)                                                                                  | [2022-01-08](https://web.archive.org/web/20220404165225/https://mob.co.uk/)                                                                                                | ❌                                            |
| [Recipe Box](https://www.recipebox.com)                                                                       | [2022-03-07](https://www.whois.com/whois/recipebox.com)                                                                                                                    | ❌                                            |
| [CookTime](https://letscooktime.com)                                                                          | [2022-04-10](https://www.whois.com/whois/letscooktime.com)                                                                                                                 | ❌                                            |
| [Simple Weekly Meal Planner](https://simpleweeklymealplanner.com)                                             | [2022-05-04](https://www.whois.com/whois/simpleweeklymealplanner.com)                                                                                                      | ❌                                            |
| [Lollipop](https://www.lollipopai.com)                                                                        | [2022-06-29](https://techcrunch.com/2021/06/29/lollipop-ai-launches-online-grocery-marketplace-where-you-can-build-your-own-recipes/)                                      | ❌                                            |
| [Umami](https://www.umami.recipes)                                                                            | [2022-07-12](https://web.archive.org/web/20220801023533/https://apps.apple.com/us/app/umami-recipes/id1597523594)                                                          | ❌                                            |
| [Potluck](https://www.inkandswitch.com/potluck/)                                                              | [2022-11-01](https://web.archive.org/web/20221101163749/https://www.inkandswitch.com/potluck/)                                                                             | ❌                                            |

## Dev

**Note:** postgres is required. Either run it via `docker-compose -f **docker-compose-dev.yml -d` or via the homebrew cask mac app.
NPM and [Poetry](https://github.com/sdispater/poetry) (0.12) are required for frontend and backend installation.

```shell
# create a .env with `DEBUG=1`. Note: you may need to update database URIs and related vars.
cp .env-example .env
echo "DEBUG=1" >> .env

cd frontend
npm install
s/dev
s/test
s/lint
cd -

cd backend
brew install postgres # necessary for binary pyscopg2
poetry config virtualenvs.in-project true
poetry install
# start postgres (DBngin.app is nice on Mac)
s/dev
s/test
s/lint

# use `npm` and `poetry` to add and upgrade dependencies
npm add $FOO
poetry add $BAR
```

### view postgres queries

1. update the `postgresql.conf` to include have:

```
log_statement = 'all'
log_directory = 'pg_log'
log_filename = 'postgresql.log'
logging_collector = on
log_min_error_statement = error
log_rotation_size = 10MB
```

2. tail the log file

```
tail -f "/Users/$USER/Library/Application Support/com.tinyapp.DBngin/Engines/postgresql/ED55F0A6-5CC7-49A4-B8D5-A5E819F1F1CB/pg_log/postgresql.log"
```

### connect to prod postgres from local

1. setup ssh proxy

```
ssh -N -L 1111:127.0.0.1:5432 recipeyak
```

2. update .env

```
DATABASE_URL=postgres://postgres@localhost:1111/recipeyak
```

## Prod

### Deploy a new release

1. Copy `.env-example` to `.env` and add in the proper configuration variables
2. [Install Ansible](https://docs.ansible.com/ansible/latest/index.html)
3. Setup [Ansible Inventory](https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html)

   ```yml
   ---
   all:
     hosts:
       recipeyak:
         ansible_host: 255.255.255.255
         ansible_user: root
   ```

4. Run the playbook

   ```shell
   ansible-playbook ./infrastructure/playbooks/deploy.yml
   ```

### Maintenance mode

Enabling maintenance mode returns a 503 status code with a webpage explaining the site is down for maintenance.

```shell
ansible-playbook ./infrastructure/playbooks/maintenance_mode.yml
```

## Configuration

Environment variables are used for configuration. Unless otherwise stated, a value is required.

- [`DJANGO_SECRET_KEY`][django-secret] — long, randomized string required for django
  - ex: `284urfljkdflsdf`
- `DATABASE_URL` — URL for Django's database
  - ex: `postgres://postgres@postgres:5432/postgres`
- `EMAIL_HOST` — SMTP hostname for sending email from Django
  - ex:`smtp.mailgun.org`
- `EMAIL_HOST_USER` — SMTP email for logging into server
  - ex: `server@example.com`
- `EMAIL_HOST_PASSWORD` — SMTP password for authenticating
  - ex: `SomeUnguessablePassword`
- [`SENTRY_DSN`][sentry-dsn] — Sentry secret configuration for backend.
  - ex: `https://<key>:<secret>@sentry.io/<project>`
- [`FRONTEND_SENTRY_DSN`][sentry-dsn] — Sentry configuration for frontend.
  - ex: `https://<key>@sentry.io/<project>`
- `AWS_ACCESS_KEY_ID` — AWS access key for backups and image upload.
  - ex: `someAWSKey`
- `AWS_SECRET_ACCESS_KEY` — AWS secret key for backups and image upload.
  - ex: `someSecretKey`
- `STORAGE_BUCKET_NAME` — Bucket for image upload.
  - ex: `recipeyak-production`
- `STORAGE_HOSTNAME` — Hostname to use to access image bucket. An s3 hostname or cloudfront distribution hostname.
  - ex: `594f11c618d1.cloudfront.net`

### AWS configuration

1. Create an S3 bucket and configure a CORS policy that allows the website to upload resources.

   ```json
   [
     {
       "AllowedHeaders": ["*"],
       "AllowedMethods": ["PUT", "POST"],
       "AllowedOrigins": ["http://localhost:*", "https://recipeyak.com"],
       "ExposeHeaders": []
     }
   ]
   ```

2. Create an IAM policy to give your AWS ID access to `get_object` and `put_object` for your bucket.
3. Configure imgix to pull from the bucket.

[django-secret]: https://docs.djangoproject.com/en/dev/ref/settings/#std:setting-SECRET_KEY
[sentry-dsn]: https://docs.sentry.io/quickstart/#about-the-dsn
